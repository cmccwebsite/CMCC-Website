<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulletin | Canadian Martyrs Catholic Church 加拿大殉道聖人天主堂</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
<!--==================== HEADER ====================-->
    <div id="header-container"></div>
    <script>
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
            });
    </script>
<!--==================== MAIN CONTENT ====================-->
    <img class="banner" src="images/corkboard.png">       
    <div class="page-container">
        <p class="page-title">Bulletin</p>
        <br>
        <div class="bulletin-container" id="bulletins"></div>
    </div>
    <div class="footer">
        <p>&copy; 2025 Canadian Martyrs Catholic Church 加拿大殉道聖人天主堂. All Rights Reserved.</p>
    </div>
    <script src="script.js"></script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <script>
const API_KEY = "AIzaSyA0PTP3yw_R1MmdZKedqQHYszNfA1nIVEw";
const FOLDER_ID = "1nkwiNAfgwM5nmzjTl7i9ugn583JWFnBz";

const url = `https://www.googleapis.com/drive/v3/files?q='${FOLDER_ID}'+in+parents&key=${API_KEY}&fields=files(id,name,mimeType,webViewLink,thumbnailLink,shortcutDetails)`;

fetch(url)
  .then(response => response.json())
  .then(async data => {
    const container = document.getElementById("bulletins");

    if (!data.files || data.files.length === 0) {
      container.innerHTML = "<p>No bulletins found.</p>";
      return;
    }

    // Sort files by name (newest first)
    data.files.sort((a, b) => b.name.localeCompare(a.name));

    for (const file of data.files) {
      let actualFile = file;

      // If the file is a shortcut, fetch the target file
      if (file.mimeType === "application/vnd.google-apps.shortcut") {
        const targetId = file.shortcutDetails.targetId;

        const res = await fetch(`https://www.googleapis.com/drive/v3/files/${targetId}?key=${API_KEY}&fields=id,name,thumbnailLink,webViewLink`);
        const targetData = await res.json();

        actualFile = {
          ...file,
          ...targetData, // Override with actual file's thumbnail and webViewLink
        };
      }

      let fileName = actualFile.name.replace(".pdf", "");
      let date = fileName.substring(0, 10);
      let title = fileName.substring(11);

      let item = document.createElement("div");
      item.classList.add("bulletin");
      item.innerHTML = `
        <img src="${actualFile.thumbnailLink || 'https://via.placeholder.com/150'}" alt="Bulletin">
        <p class="date">${date}</p>
        <p class="title">${title}</p>
        <a href="${actualFile.webViewLink}" target="_blank">View Bulletin</a>
      `;
      container.appendChild(item);
    }
  })
  .catch(error => {
    console.error("Error loading bulletins:", error);
    document.getElementById("bulletins").innerHTML = "<p>Failed to load bulletins.</p>";
  });
</script>

</body>
